name: RDP-Rapzz-CRD
on: workflow_dispatch

jobs:
  secure-rdp:
    runs-on: windows-latest
    timeout-minutes: 3600

    steps:
      - name: Disable Windows Password Complexity
        run: |
          secedit /export /cfg config.inf
          (Get-Content config.inf) -replace 'PasswordComplexity = 1', 'PasswordComplexity = 0' | Set-Content config.inf
          secedit /configure /db $env:windir\security\local.sdb /cfg config.inf /areas SECURITYPOLICY
          Remove-Item config.inf

      - name: Create RDP User Rapzz
        run: |
          $password = "RapzzPw" 
          $securePass = ConvertTo-SecureString $password -AsPlainText -Force
          New-LocalUser -Name "Rapzz" -Password $securePass -Description "RDP User" -AccountNeverExpires
          Add-LocalGroupMember -Group "Administrators" -Member "Rapzz"

      - name: Install Chrome Remote Desktop
        run: |
          $downloader = New-Object System.Net.WebClient
          $downloader.DownloadFile("https://dl.google.com/edgedl/chrome-remote-desktop/chromeremotedesktophost.msi", "crd.msi")
          Start-Process msiexec.exe -ArgumentList "/i crd.msi /qn /norestart" -Wait
          Remove-Item crd.msi

      - name: Setup & Start CRD
        shell: pwsh
        run: |
          # NOTE: Replace the code below with a fresh one from https://remotedesktop.google.com/headless
          & "${Env:PROGRAMFILES(X86)}\Google\Chrome Remote Desktop\CurrentVersion\remoting_start_host.exe" `
            --code="4/0AfrIepDzYkNNnEZ1zDz3m32C7W7ngvSKMOr6y8Q8cQ7yTeU3xgA0I2IMMJ-N8h6x2Y5-7g" `
            --redirect-url="https://remotedesktop.google.com/_/oauthredirect" `
            --name=$Env:COMPUTERNAME `
            --pin=123456

      - name: Maintain Connection & Show Info
        run: |
          Write-Host "`n==============================" -ForegroundColor Cyan
          Write-Host "   CRD BYPASS SUCCESS!" -ForegroundColor Green
          Write-Host "==============================" -ForegroundColor Cyan
          Write-Host "User       : Rapzz"
          Write-Host "Pass       : RapzzPw"
          Write-Host "Default PIN: 123456"
          Write-Host "Check here : https://remotedesktop.google.com/access"
          Write-Host "==============================`n"
          while ($true) {
            $date = Get-Date -Format "HH:mm:ss"
            Write-Host "[$date] Runner is active... ðŸš€"
            Start-Sleep -Seconds 300
          }
